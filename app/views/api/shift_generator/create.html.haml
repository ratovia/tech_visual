%section.shift_api_create_page
  %h1.page_title シフト一覧
  .shift-tables.shift-slick_container{data: {workrole: {ids: WorkRole.ids}}}
    - (DateTime.parse(@period[:start])..DateTime.parse(@period[:finish])).each do |this_day|
      .shift-table
        %h
          = this_day.strftime("%Y/%m/%d")
        %table
          %tr
            %th
            - [*0..23].each do |d|
              - if d >= 8 && d <= 24
                %th
                  = d
              - else
                %th.hidden
                  = d
          - User.all.each do |user|
            -# 該当ユーザのshiftインスタンスだけに絞って、配列に直す。24時間中で何時にシフトインするかworkrole_idを入れた配列を作る。
            -# TODO　処理が複雑なので、整理して、helperに書き出す
            - current_user_shifts = @result[:shift].map{ |shift| shift if user.id == shift[:user_id] && this_day.strftime("%Y/%m/%d") == shift[:shift_in_at].strftime("%Y/%m/%d") }.compact!
            - array = [nil] * Settings.DATE_TIME
            - current_user_shifts.each do |shift|
              - shift_time_to_array(shift).each_with_index do |_ary, i| 
                - array[i] ||= _ary
            %tr
              %td 
                = user.name
              - array.each_with_index do |is_shift, i|
                - if i >= 8 && i <= 24
                  - if is_shift
                    %td.color_shift-data{data: {workrole: {id: is_shift}}}
                  - else
                    %td
                - else
                  %td.hidden



                      